<html>
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>phts.hrkltz</title>
      <style>
         html, body {
            margin: unset;
         }

         div#gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0px;
            padding: 10px;
         }

         div#gallery > img {
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            background-color: #f0f0f0; /* Placeholder color before image loads */
         }
         
         img {
            max-width: 100vw;
            max-height: 100dvh;
         }
      </style>
   </head>
   <body>
      <div id="gallery">
         <!-- <img data-src="image/org/IMG_1603.jpg" alt="Image 1" loading="lazy"> -->
         <!-- Add more images as needed -->
      </div>
   </body>
   <script>
      const galleryDiv = document.getElementById('gallery');

      // Event listener for back/forward button navigation
      window.onpopstate = function(event) {
         console.log(event);
         if (event.state) {
            switch (event.state.page) {
               case 1:
                  //buildPage0();
                  buildPage1(event.state.countryCode);
                  break;
               case 2:
                  alert('Page 2');
                  break;
            };
         } else {
            buildPage0();
         };
      };

      buildPage0();

      /*fetch('https://api.github.com/repos/oliver-hrkltz/photos/contents/data?ref=main')
         .then((response) => response.json())
         .then((object) => {
            const imagePathArray = object
               //.filter((treeElement) => treeElement.path.endsWith('.webp'))
               .map((treeElement) => treeElement.name)
               .map((countryCode) => {
                  const imgElement = document.createElement("img");
                  imgElement.alt = 'Random image';
                  imgElement.loading = 'lazy';
                  imgElement.src = `https://flagsapi.com/${countryCode}/flat/64.png`
                  imgElement.onclick = function() {
                     history.pushState({ page: 1 }, `${countryCode}`, null);

                     galleryDiv.innerHTML = '';
                     fetch(`https://api.github.com/repos/oliver-hrkltz/photos/contents/data/${countryCode}?ref=main`)
                        .then((response) => response.json())
                        .then((object) => {
                           const imagePathArray = object
                              .filter((treeElement) => treeElement.path.endsWith('.webp'))
                              .map((treeElement) => treeElement.name)
                              .map((name) => {
                                 const imgElement = document.createElement("img");
                                 imgElement.alt = 'Random image';
                                 imgElement.loading = 'lazy';
                                 imgElement.src = `https://media.githubusercontent.com/media/oliver-hrkltz/photos/refs/heads/main/data/${countryCode}/${name}`;
                                 imgElement.onclick = function() {
                                    history.pushState({ page: 2 }, `${countryCode}/${name}`, null);
                                    // TODO: Open picture in full screen.
                                 }
                                 galleryDiv.appendChild(imgElement);
                              });
                        });
                  }
                  galleryDiv.appendChild(imgElement);
               });
         });*/

         function buildPage0() {
            galleryDiv.innerHTML = '';
            fetch('https://api.github.com/repos/oliver-hrkltz/photos/contents/data?ref=main')
               .then((response) => response.json())
               .then((object) => {
                  const imagePathArray = object
                     //.filter((treeElement) => treeElement.path.endsWith('.webp'))
                     .map((treeElement) => treeElement.name)
                     .map((countryCode) => {
                        const imgElement = document.createElement("img");
                        imgElement.alt = 'Random image';
                        imgElement.loading = 'lazy';
                        imgElement.src = `https://flagsapi.com/${countryCode}/flat/64.png`
                        imgElement.onclick = function() {
                           console.log('pushState');
                           history.pushState({ 'page': 1, 'countryCode': countryCode }, null);
                           buildPage1(countryCode);
                        }
                        galleryDiv.appendChild(imgElement);
                     });
               });
         }

         function buildPage1(countryCode) {
            galleryDiv.innerHTML = '';
            fetch(`https://api.github.com/repos/oliver-hrkltz/photos/contents/data/${countryCode}?ref=main`)
               .then((response) => response.json())
               .then((object) => {
                  const imagePathArray = object
                     .filter((treeElement) => treeElement.path.endsWith('.webp'))
                     .map((treeElement) => treeElement.name)
                     .map((name) => {
                        const imgElement = document.createElement("img");
                        imgElement.alt = 'Random image';
                        imgElement.loading = 'lazy';
                        imgElement.src = `https://media.githubusercontent.com/media/oliver-hrkltz/photos/refs/heads/main/data/${countryCode}/${name}`;
                        imgElement.onclick = function() {
                           //console.log('pushState');
                           //history.pushState({ page: 2 }, `${countryCode}/${name}`, null);
                           // TODO: Open picture in full screen.
                        }
                        galleryDiv.appendChild(imgElement);
                     });
               });
         }
   </script>
</html>